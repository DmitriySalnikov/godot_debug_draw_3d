diff --git a/binding_generator.py b/binding_generator.py
index faf2913..87960df 100644
--- a/binding_generator.py
+++ b/binding_generator.py
@@ -205,6 +205,11 @@ def get_file_list(api_filepath, output_dir, headers=False, sources=False):
     with open(api_filepath, encoding="utf-8") as api_file:
         api = json.load(api_file)
 
+    import sys
+    sys.path.insert(0, "../patches")
+    import get_used_classes
+    sys.path.pop(0)
+    get_used_classes.scan_dependencies(api)
     return _get_file_list(api, output_dir, headers, sources)
 
 
diff --git a/tools/godotcpp.py b/tools/godotcpp.py
index 8ca48b3..a5fae3b 100644
--- a/tools/godotcpp.py
+++ b/tools/godotcpp.py
@@ -134,6 +134,12 @@ def no_verbose(env):
 
 
 def scons_emit_files(target, source, env):
+    import sys
+    sys.path.insert(0, "../patches")
+    import get_used_classes
+    sys.path.pop(0)
+    get_used_classes.setup(env.get("exclude_unused_classes", True), env.get("folder_to_include_classes", "../src"))
+
     profile_filepath = env.get("build_profile", "")
     if profile_filepath:
         profile_filepath = normalize_path(profile_filepath, env)
@@ -143,7 +149,7 @@ def scons_emit_files(target, source, env):
 
     api = generate_trimmed_api(str(source[0]), profile_filepath)
     files = []
-    for f in _get_file_list(api, target[0].abspath, True, True):
+    for f in get_used_classes.delete_useless(_get_file_list(api, target[0].abspath, True, True)):
         file = env.File(f)
         if profile_filepath:
             env.Depends(file, profile_filepath)
@@ -379,6 +385,10 @@ def options(opts, env):
     opts.Add(BoolVariable("dev_build", "Developer build with dev-only debugging code (DEV_ENABLED)", False))
     opts.Add(BoolVariable("verbose", "Enable verbose output for the compilation", False))
 
+    opts.Add(BoolVariable("exclude_unused_classes", "Disable generation of unused classes.", True))
+    opts.Add(PathVariable("folder_to_include_classes", "Path to the directory containing extension sources", "../src", PathVariable.PathIsDir))
+    opts.Add(PathVariable("custom_godotcpp_suffix", "Additional custom library suffix", "", PathVariable.PathAccept))
+
     # Add platform options (custom tools can override platforms)
     for pl in sorted(set(platforms + custom_platforms)):
         tool = Tool(pl, toolpath=get_platform_tools_paths(env))
@@ -514,8 +524,8 @@ def generate(env):
     if not env["threads"]:
         suffix += ".nothreads"
 
-    env["suffix"] = suffix  # Exposed when included from another project
-    env["OBJSUFFIX"] = suffix + env["OBJSUFFIX"]
+    env["suffix"] = suffix + env["custom_godotcpp_suffix"] # Exposed when included from another project
+    env["OBJSUFFIX"] = suffix + env["custom_godotcpp_suffix"] + env["OBJSUFFIX"]
 
     # compile_commands.json
     env.Tool("compilation_db")
